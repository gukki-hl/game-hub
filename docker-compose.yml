# Docker Compose 配置 - 支持开发和生产环境

services:
  # 开发环境服务
  dev:
    image: node:18-alpine
    working_dir: /app
    command: sh -c "npm install && npm run dev"
    ports:
      - "5173:5173"
    volumes:
      # 挂载源代码（支持热重载）
      - .:/app
      # 使用命名卷存储 node_modules（提高性能）
      - node_modules:/app/node_modules
    environment:
      - VITE_SENTRY_DSN=${VITE_SENTRY_DSN:-}
      - VITE_API_URL=${VITE_API_URL:-}
      - VITE_APP_VERSION=${VITE_APP_VERSION:-1.0.0-dev}
    env_file:
      - .env
    profiles:
      - dev
    stdin_open: true
    tty: true

  # 生产环境服务
  prod:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_SENTRY_DSN=${VITE_SENTRY_DSN:-}
        - VITE_API_URL=${VITE_API_URL:-}
        - VITE_APP_VERSION=${VITE_APP_VERSION:-1.0.0}
    ports:
      - "8080:8080"
    profiles:
      - prod
    restart: unless-stopped

volumes:
  node_modules:
